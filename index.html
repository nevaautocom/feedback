<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—Ü–µ–Ω–∏—Ç–µ –Ω–∞—à —Å–µ—Ä–≤–∏—Å</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: 40px auto; }
    .stars { display: flex; gap: 10px; font-size: 24px; cursor: pointer; }
    .stars span { padding: 5px; }
    .selected { color: gold; }
    #feedbackForm { display: none; margin-top: 20px; }
  </style>
</head>
<body>

  <h2>–ö–∞–∫ –í–∞–º –Ω–∞—à —Å–µ—Ä–≤–∏—Å?</h2>
  <div class="stars" id="starContainer">
    <span data-value="1">‚òÖ</span>
    <span data-value="2">‚òÖ</span>
    <span data-value="3">‚òÖ</span>
    <span data-value="4">‚òÖ</span>
    <span data-value="5">‚òÖ</span>
  </div>

  <div id="feedbackForm">
    <p>–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?</p>
    <textarea id="feedback" rows="4" cols="50" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –æ—Ç–∑—ã–≤..." required></textarea><br>
    <button onclick="submitFeedback()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <script>
    const stars = document.querySelectorAll('.stars span');
    const feedbackForm = document.getElementById('feedbackForm');
    const yandexLink = "https://yandex.ru/maps/org/folksvagen_neva_avtokom/3046919187/reviews/?add-review=true&ll=30.321069%2C59.882415&z=16";

    let selectedRating = 0;

    const BOT_TOKEN = '7293636647:AAF2gUna3cxy1gyPslr-zDZSnlKzTE2WLy0';
    const CHAT_ID = 7142031846;

    stars.forEach(star => {
      star.addEventListener('click', () => {
        selectedRating = parseInt(star.dataset.value);
        highlightStars(selectedRating);

        if (selectedRating === 5) {
          window.location.href = yandexLink;
        } else {
          feedbackForm.style.display = 'block';
        }
      });
    });

    function highlightStars(rating) {
      stars.forEach(star => {
        star.classList.toggle('selected', parseInt(star.dataset.value) <= rating);
      });
    }

    function submitFeedback() {
      const text = document.getElementById('feedback').value.trim();
      if (!text) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤.");
        return;
      }

      const message = ‚≠ê –û—Ü–µ–Ω–∫–∞: ${selectedRating}\nüí¨ –û—Ç–∑—ã–≤: ${text};

      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: message
        })
      })
      .then(res => {
        if (res.ok) {
          alert("–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤!");
          feedbackForm.style.display = 'none';
          document.getElementById('feedback').value = '';
        } else {
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–∑—ã–≤–∞.");
        }
      })
      .catch(err => {
        alert("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: " + err.message);
      });
    }
  </script>

</body>
</html>
